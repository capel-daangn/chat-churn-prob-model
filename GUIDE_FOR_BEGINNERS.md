# 🎓 채팅 이탈 예측 모델 - 초보자를 위한 쉬운 가이드

> 머신러닝을 처음 접하는 분들을 위한 친절한 설명서

---

## 📌 목차

1. [이 프로그램이 하는 일](#1-이-프로그램이-하는-일)
2. [왜 필요한가요?](#2-왜-필요한가요)
3. [어떻게 작동하나요?](#3-어떻게-작동하나요)
4. [설치하고 실행하기](#4-설치하고-실행하기)
5. [결과 보는 법](#5-결과-보는-법)
6. [용어 설명](#6-용어-설명)
7. [문제 해결](#7-문제-해결)

---

## 1. 이 프로그램이 하는 일

### 🎯 한 문장 요약
**채팅 메시지를 보고 "이 대화가 곧 끝날 것 같은지" 예측하는 AI 프로그램입니다.**

### 📱 실생활 예시

중고거래 앱에서 이런 대화를 본 적 있으시죠?

```
구매자: "이 상품 아직 구매 가능한가요?"
판매자: "네, 가능합니다!"
구매자: "가격 네고 가능할까요?"
판매자: "죄송하지만 정찰제입니다."
구매자: "음... 좀 비싸네요"          ← 이 메시지 이후 대화 끊길 확률: 85%
```

이 프로그램은 마지막 메시지("음... 좀 비싸네요")를 보고:
- ❌ 부정적인 감정 감지
- ⚠️ 짧고 애매한 답변
- 🚨 이탈 신호 키워드 발견

→ **결론: 이 대화는 85% 확률로 곧 끝날 것 같습니다!**

### 🎁 이걸 알면 뭐가 좋은가요?

1. **고객 이탈 방지**: 대화가 끊기기 전에 할인 쿠폰이나 추가 정보 제공
2. **상담원 배치**: 위험한 대화에 사람 상담원 투입
3. **서비스 개선**: 어떤 표현이 고객을 떠나게 만드는지 분석

---

## 2. 왜 필요한가요?

### ❌ 기존 방식의 문제점

**사람이 직접 확인하는 경우:**
- 하루에 수천 개의 채팅을 모두 확인 불가능
- 사람마다 판단 기준이 다름
- 피곤하면 놓치는 것들이 생김

**단순 키워드 필터링:**
```
"아니요" → 이탈 가능성 높음?
"네, 아니요 괜찮습니다!" → 이것도 "아니요"가 있어서 위험 판정? ❌
```
→ 문맥을 이해하지 못함

### ✅ AI 모델의 장점

- **24시간 작동**: 쉬지 않고 모든 메시지 분석
- **일관성**: 똑같은 기준으로 판단
- **문맥 이해**: 단어가 아니라 의미를 파악
- **학습 가능**: 시간이 지날수록 더 똑똑해짐

---

## 3. 어떻게 작동하나요?

### 🧠 전체 흐름 (4단계)

```
1단계: 데이터 준비
   └─→ 예전 채팅 로그에서 "이탈했다/안했다" 표시

2단계: AI 학습
   └─→ 수천 개의 예시를 보며 패턴 찾기

3단계: 테스트
   └─→ 새로운 메시지로 잘 맞추는지 확인

4단계: 실전 사용
   └─→ 실제 채팅에 적용
```

### 🔍 구체적인 작동 원리 (비유로 설명)

#### Step 1: 메시지를 숫자로 바꾸기 (임베딩)

컴퓨터는 글을 직접 이해하지 못하므로 **숫자로 변환**합니다.

```
"가격 네고 가능할까요?"
   ↓ (DistilBERT가 변환)
[0.23, -0.41, 0.88, ... 768개의 숫자]
```

**비유**: 마치 음식을 요리할 때 재료를 잘게 다지는 것과 비슷합니다.

#### Step 2: 추가 정보 수집 (메타 피처)

글자 수만 봐도 힌트가 됩니다:

```
"네" → 1글자 (짧음, 성의 없음?)
"네 좋습니다! 구매할게요" → 14글자 (긍정적)
```

프로그램이 보는 것들:
- 📏 **메시지 길이**: 짧을수록 이탈 가능성 높음
- ⏱️ **응답 시간**: 오래 걸릴수록 관심도 떨어짐
- 😊😞 **감정 점수**: 긍정/부정 감정 분석
- 🚪 **종료 신호**: "고민해볼게요" 같은 표현 감지

#### Step 3: AI가 판단 (LightGBM)

모든 정보를 종합해서 확률 계산:

```
메시지 길이: 3글자 → 위험 +20%
감정 점수: -0.7 (부정) → 위험 +40%
종료 키워드: "..." 발견 → 위험 +25%
───────────────────────────────
최종 이탈 확률: 85%
```

#### Step 4: 설명 제공 (SHAP)

"왜 85%라고 판단했는지" 설명:

```
📊 이탈 확률 85% 이유:
   감정 점수(부정): +35%
   짧은 메시지: +20%
   종료 키워드: +15%
   응답 지연: +15%
```

---

## 4. 설치하고 실행하기

### 💻 필요한 것

- **컴퓨터**: Mac, Windows, Linux 모두 가능
- **Python**: 3.8 이상 (코딩 언어)
- **시간**: 첫 실행 시 30분~1시간 정도

### 📥 설치 방법 (복사-붙여넣기만 하세요!)

#### 1단계: 프로그램 다운로드

```bash
# 터미널(Mac) 또는 명령 프롬프트(Windows)에서 실행
cd 원하는폴더경로
```

#### 2단계: 필요한 도구 설치

```bash
pip install -r requirements.txt
```

⏱️ **예상 시간**: 5~10분
💡 **팁**: 커피 한 잔 하고 오세요!

### 🚀 실행 방법

#### 방법 1: 한 번에 다 하기 (추천!)

```bash
python run_pipeline.py --full-analysis
```

**이 명령어가 하는 일**:
1. ✅ 가짜 채팅 데이터 500개 만들기
2. ✅ AI가 이해할 수 있게 변환하기
3. ✅ 모델 학습시키기
4. ✅ 성능 테스트하기
5. ✅ SHAP 분석 (왜 그렇게 판단했는지)
6. ✅ 임베딩 분석 (어떤 의미가 중요한지)
7. ✅ 예쁜 리포트 만들기 (HTML)

⏱️ **예상 시간**: 10~15분

#### 방법 2: 대시보드 보기

```bash
streamlit run app.py
```

그러면 웹 브라우저가 자동으로 열립니다!

**할 수 있는 것**:
- 📝 직접 메시지 입력해서 테스트
- 📊 예측 결과를 바로 확인
- 🔬 왜 그렇게 판단했는지 그래프로 보기

---

## 5. 결과 보는 법

### 📂 생성되는 파일들

실행이 끝나면 `models/` 폴더에 여러 파일이 생깁니다:

#### 🎯 기본 결과

| 파일 | 설명 | 보는 법 |
|------|------|---------|
| `churn_model.txt` | 학습된 AI 모델 | 직접 볼 필요 없음 (프로그램이 사용) |
| `evaluation_curves.png` | 성능 그래프 | 이미지 뷰어로 열기 |
| `feature_importance.png` | 중요한 정보 순위 | 이미지 뷰어로 열기 |

#### 🔬 SHAP 분석 결과

| 파일 | 보는 것 |
|------|---------|
| `shap_summary.png` | 어떤 정보가 가장 중요한지 |
| `shap_waterfall_*.png` | 특정 메시지를 왜 그렇게 판단했는지 |
| `embedding_importance.png` | 768개 숫자 중 어떤 것이 중요한지 |

#### 📄 리포트

**`churn_analysis_report.html`**
- 웹 브라우저로 열기
- 모든 분석 결과를 예쁘게 정리
- 경영진에게 보고할 때 유용!

### 📊 결과 해석하기

#### 예시 1: 성능 그래프 (ROC Curve)

```
그래프가 왼쪽 위로 휘어질수록 좋음!

    완벽 (100점) ↑
                 |  ╱
                 | ╱
                 |╱   ← 우리 모델
    랜덤 (50점)  |
                 └─────────→
```

**해석**:
- 대각선에 가까우면 → 랜덤 찍기 수준 (나쁨)
- 왼쪽 위로 휠수록 → 예측 잘함 (좋음)

#### 예시 2: SHAP Waterfall Plot

```
기준값: 30%

감정 점수 (부정)    →  +35%  (65%)
짧은 메시지         →  +15%  (80%)
종료 키워드         →   +5%  (85%)
───────────────────────────────
최종 예측: 85%
```

**해석**:
- 빨간색 바 → 이탈 확률 높임
- 파란색 바 → 이탈 확률 낮춤
- 바가 길수록 영향 큼

---

## 6. 용어 설명

### 🤖 AI/머신러닝 용어

| 용어 | 쉬운 설명 | 비유 |
|------|-----------|------|
| **모델** | AI의 뇌 | 학습한 지식이 저장된 책 |
| **학습** | 예시를 보고 패턴 찾기 | 수학 문제집 풀면서 요령 익히기 |
| **예측** | 새로운 것에 대해 추측 | 시험 문제 풀기 |
| **피처** | 판단에 사용하는 정보 | 사람 인상 판단 시 얼굴, 옷차림 등 |
| **라벨** | 정답 (이탈했다/안했다) | 문제집의 정답 |

### 📊 성능 지표 용어

| 용어 | 의미 | 좋은 값 |
|------|------|---------|
| **AUROC** | 전반적인 예측 능력 | 0.5(최악) ~ 1.0(완벽)<br>0.8 이상이면 좋음 |
| **정확도** | 맞춘 비율 | 100%에 가까울수록 좋음 |
| **재현율** | 실제 이탈을 잘 잡아냈는지 | 높을수록 좋음 |
| **정밀도** | 이탈 예측이 정확했는지 | 높을수록 좋음 |

### 🧩 기술 용어

| 용어 | 설명 | 왜 사용하나요? |
|------|------|----------------|
| **DistilBERT** | 언어 이해 AI | 문장의 의미를 숫자로 바꿔줌 |
| **LightGBM** | 판단을 내리는 AI | 빠르고 정확함 |
| **SHAP** | 설명 도구 | "왜?"에 대한 답변 제공 |
| **임베딩** | 단어→숫자 변환 | 컴퓨터가 이해할 수 있게 |

---

## 7. 문제 해결

### ❓ 자주 묻는 질문 (FAQ)

#### Q1: 실행이 너무 오래 걸려요

**A**: 처음 실행은 시간이 걸립니다. 이유:
- DistilBERT 모델 다운로드 (~500MB)
- 500개 대화 처리
- SHAP 분석 계산

**해결책**:
```bash
# 데이터 개수 줄이기
config.yaml 파일에서:
num_conversations: 500 → 100 으로 변경
```

#### Q2: 에러가 나요 (ModuleNotFoundError)

**A**: 필요한 패키지가 설치 안 됨

**해결책**:
```bash
pip install -r requirements.txt
```

#### Q3: 메모리 부족 에러

**A**: SHAP 분석이 메모리를 많이 씀

**해결책**:
```bash
# SHAP 샘플 수 줄이기
python -m src.shap_analysis  # 기본: 500개
# 코드에서 max_samples=100 으로 변경
```

#### Q4: 실제 데이터로 바꾸고 싶어요

**A**:
1. 채팅 데이터를 CSV 형식으로 준비:
   ```
   message_id,conversation_id,sender_role,content,created_at,label
   1,conv1,buyer,"가격 네고 가능할까요?",2024-01-01,0
   2,conv1,seller,"죄송합니다 정찰제입니다",2024-01-01,0
   ...
   ```

2. `config.yaml` 수정:
   ```yaml
   paths:
     raw_data: "data/raw/your_real_data.csv"
   ```

3. Step 2부터 실행:
   ```bash
   python run_pipeline.py --start-from features
   ```

#### Q5: GPU가 없는데 괜찮나요?

**A**: 네! 이 프로젝트는 CPU만으로도 작동하도록 설계되었습니다.
- 속도는 조금 느려도 정상 작동
- Mac, 일반 노트북 모두 OK

---

## 🎯 다음 단계

### 초급: 기본 사용
1. ✅ 전체 파이프라인 실행해보기
2. ✅ 대시보드에서 메시지 테스트
3. ✅ 리포트 읽어보기

### 중급: 커스터마이징
1. `config.yaml`에서 설정 바꿔보기
2. 실제 데이터로 교체
3. 다른 파라미터로 실험

### 고급: 개선
1. 더 많은 데이터로 학습
2. 피처 추가 (예: 이모지 개수)
3. 다른 모델 시도

---

## 💡 팁과 트릭

### ✨ 빠르게 테스트하기

```bash
# 최소 설정으로 빠른 테스트
python run_pipeline.py --skip-data --skip-features --start-from train
```

### 📈 성능 높이기

1. **데이터 늘리기**:
   ```yaml
   num_conversations: 500 → 2000
   ```

2. **학습 시간 늘리기**:
   ```yaml
   num_boost_round: 500 → 1000
   ```

3. **실제 데이터 사용**: 가짜 데이터보다 훨씬 좋음!

### 🎨 대시보드 활용

```bash
streamlit run app.py
```

**활용 예시**:
- 팀 회의에서 실시간 데모
- 다양한 메시지 패턴 테스트
- 고객 상담팀 교육 자료

---

## 📚 더 알아보기

### 추천 학습 자료

**머신러닝 기초**:
- [Google의 머신러닝 단기집중과정](https://developers.google.com/machine-learning/crash-course)
- [3Blue1Brown 신경망 시리즈](https://www.youtube.com/watch?v=aircAruvnKk) (유튜브)

**자연어 처리**:
- [허깅페이스 튜토리얼](https://huggingface.co/learn)
- [BERT 논문 쉽게 설명](https://jalammar.github.io/illustrated-bert/)

**SHAP 설명력**:
- [SHAP 공식 문서](https://shap.readthedocs.io/)
- [모델 해석 가이드](https://christophm.github.io/interpretable-ml-book/)

---

## 🤝 도움이 필요하세요?

### 문제가 생겼을 때

1. **에러 메시지 읽기**: 무엇이 문제인지 힌트가 있음
2. **로그 확인**: 어디서 멈췄는지 확인
3. **검색**: 에러 메시지를 구글에 검색
4. **이슈 제기**: [GitHub Issues](https://github.com/anthropics/claude-code/issues)

### 성공 체크리스트

- [ ] 프로그램이 에러 없이 실행됨
- [ ] `models/` 폴더에 파일들이 생성됨
- [ ] 대시보드가 브라우저에서 열림
- [ ] 메시지 입력 시 확률이 나옴
- [ ] 리포트 HTML이 정상적으로 보임

---

## 🎊 마무리

축하합니다! 이제 여러분은:

✅ AI가 채팅 이탈을 예측하는 방법을 이해했습니다
✅ 프로그램을 직접 실행할 수 있습니다
✅ 결과를 해석할 수 있습니다
✅ 실무에 적용할 준비가 되었습니다

**Remember**: AI는 도구일 뿐입니다. 최종 결정은 사람이 내려야 합니다!

---

<div align="center">

**질문이 있으신가요?**

이 가이드를 읽고도 이해가 안 되는 부분이 있다면
언제든 질문하세요! 😊

</div>
